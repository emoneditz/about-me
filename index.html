<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark"> <!-- Default to dark mode -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emon Lab</title> <!-- Title set to Emon Lab -->
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom CSS variables for dark/light mode */
        :root {
            --bg-color-light: #f0f2f5;
            --text-color-light: #e0e7ff;
            --card-bg-light: rgba(255, 255, 255, 0.08);
            --border-color-light: rgba(255, 255, 255, 0.05);
            --header-bg-light: rgba(255, 255, 255, 0.05);
            --primary-glow: #00eaff;
            --secondary-glow: #e0aaff;
            --gradient-start: #00c6ff;
            --gradient-end: #a78bfa;
            --modal-bg-light: rgba(255, 255, 255, 0.1);
            --chat-bubble-user-light: rgba(0, 198, 255, 0.2);
            --chat-bubble-ai-light: rgba(167, 139, 250, 0.2);
        }

        html.dark {
            --bg-color-dark: #1a202c;
            --text-color-dark: #e2e8f0;
            --card-bg-dark: rgba(26, 32, 44, 0.08);
            --border-color-dark: rgba(255, 255, 255, 0.03);
            --header-bg-dark: rgba(26, 32, 44, 0.05);
            --primary-glow: #8affd1;
            --secondary-glow: #c4b5fd;
            --gradient-start: #8affd1;
            --gradient-end: #c4b5fd;
            --modal-bg-dark: rgba(26, 32, 44, 0.1);
            --chat-bubble-user-dark: rgba(138, 255, 209, 0.2);
            --chat-bubble-ai-dark: rgba(196, 181, 253, 0.2);
        }

        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-color-dark); /* Default to dark theme text color */
            transition: color 0.3s ease;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background-color: #000;
        }

        html.dark body {
            color: var(--text-color-dark);
        }

        /* Glassy Effect Mixin */
        .glassy {
            backdrop-filter: blur(35px) saturate(180%);
            -webkit-backdrop-filter: blur(35px) saturate(180%);
            background-color: var(--card-bg-dark);
            border: 1px solid var(--border-color-dark);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.02);
            border-radius: 20px;
            transition: all 0.4s ease-out;
        }

        html.dark .glassy {
            background-color: var(--card-bg-dark);
            border: 1px solid var(--border-color-dark);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.02);
        }

        /* Header Specific Styles */
        .header-glassy {
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            background-color: var(--header-bg-dark);
            border-bottom: 1px solid var(--border-color-dark);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        html.dark .header-glassy {
            background-color: var(--header-bg-dark);
            border-bottom: 1px solid var(--border-color-dark);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        /* Preloader Styles */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.7s ease-out;
        }

        .spinner-container {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .spinner {
            position: absolute;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }

        .spinner:nth-child(1) {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.1);
            border-top: 8px solid var(--primary-glow);
            box-shadow: 0 0 25px var(--primary-glow);
        }

        .spinner:nth-child(2) {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.1);
            border-top: 6px solid var(--secondary-glow);
            animation-delay: 0.2s;
            box-shadow: 0 0 20px var(--secondary-glow);
            top: 10px;
            left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Particle.js container */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -2;
            background: linear-gradient(135deg, #0a0a1a, #1a0a2a);
            transition: background 0.5s ease;
        }

        html.dark #particles-js {
            background: linear-gradient(135deg, #050510, #100515);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-end);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gradient-start);
        }

        /* Gradient for special text and buttons */
        .gradient-text {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
        }

        .gradient-button {
            background-image: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            box-shadow: 0 6px 20px rgba(0, 198, 255, 0.4);
            transition: all 0.3s ease;
            border: none;
        }
        .gradient-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 198, 255, 0.6);
        }
        html.dark .gradient-button {
            box-shadow: 0 6px 20px rgba(138, 255, 209, 0.4);
        }
        html.dark .gradient-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 30px rgba(138, 255, 209, 0.6);
        }

        /* Link Card specific styles */
        .link-card {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            transition: transform 0.4s ease, box-shadow 0.4s ease, background-color 0.4s ease;
            min-height: 120px;
            overflow: hidden;
        }

        .link-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            background: radial-gradient(circle at center, rgba(var(--primary-glow-rgb), 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 0;
        }

        .link-card:hover::before {
            opacity: 1;
        }

        .link-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
        }

        .link-card a {
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            text-decoration: none;
            color: inherit;
            z-index: 2;
        }

        .link-card-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .link-card-content h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-color-dark);
            transition: color 0.3s ease;
            letter-spacing: 0.025em;
        }

        html.dark .link-card-content h3 {
            color: var(--text-color-dark);
        }

        .link-card-content p {
            font-size: 1.1rem;
            color: var(--text-color-dark);
            opacity: 0.7;
            transition: color 0.3s ease, opacity 0.3s ease;
        }

        html.dark .link-card-content p {
            color: var(--text-color-dark);
        }

        .link-card:hover .link-card-content h3,
        .link-card:hover .link-card-content p {
            color: var(--primary-glow);
        }

        /* Social icon within link card */
        .link-card .social-icon-in-card {
            font-size: 3rem; /* Adjust size as needed */
            margin-bottom: 1rem;
            color: var(--primary-glow); /* Example color, can be customized per icon */
            transition: color 0.3s ease;
        }
        .link-card:hover .social-icon-in-card {
            color: var(--secondary-glow); /* Change color on hover */
        }


        /* General section padding and positioning */
        section {
            position: relative;
            z-index: 1;
            padding-top: 10rem;
            padding-bottom: 10rem;
        }

        /* Avatar glow */
        .avatar-glow {
            box-shadow: 0 0 30px rgba(138, 255, 209, 0.6), inset 0 0 15px rgba(138, 255, 209, 0.4);
            transition: all 0.4s ease;
        }
        html.dark .avatar-glow {
            box-shadow: 0 0 30px rgba(138, 255, 209, 0.6), inset 0 0 15px rgba(138, 255, 209, 0.4);
        }
        .avatar-glow:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(138, 255, 209, 0.8), inset 0 0 20px rgba(138, 255, 209, 0.6);
        }
        html.dark .avatar-glow:hover {
            box-shadow: 0 0 40px rgba(138, 255, 209, 0.8), inset 0 0 20px rgba(138, 255, 209, 0.6);
        }

        /* Define RGB values for JS use in radial gradients */
        .light-mode-rgb {
            --primary-glow-rgb: 0, 234, 255;
            --secondary-glow-rgb: 224, 170, 255;
        }
        .dark-mode-rgb {
            --primary-glow-rgb: 138, 255, 209;
            --secondary-glow-rgb: 196, 181, 253;
        }

        /* Gemini Assistant Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .gemini-modal {
            background-color: var(--modal-bg-dark);
            border: 1px solid var(--border-color-dark);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.02);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            height: 80%;
            max-height: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .modal-overlay.active .gemini-modal {
            transform: translateY(0);
            opacity: 1;
        }

        html.dark .gemini-modal {
            background-color: var(--modal-bg-dark);
            border: 1px solid var(--border-color-dark);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.02);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-glow);
            letter-spacing: 0.05em;
        }

        html.dark .modal-header {
            border-bottom: 1px solid var(--border-color-dark);
        }

        .modal-close-button {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-color-dark);
            cursor: pointer;
            transition: color 0.3s ease, transform 0.2s ease;
        }
        .modal-close-button:hover {
            color: var(--primary-glow);
            transform: rotate(90deg);
        }
        html.dark .modal-close-button {
            color: var(--text-color-dark);
        }

        .chat-history {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            scroll-behavior: smooth;
        }

        .chat-bubble {
            max-width: 80%;
            padding: 0.8rem 1.2rem;
            border-radius: 15px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chat-bubble.user {
            align-self: flex-end;
            background-color: var(--chat-bubble-user-dark);
            border: 1px solid rgba(138, 255, 209, 0.3);
            color: var(--text-color-dark);
        }
        html.dark .chat-bubble.user {
            background-color: var(--chat-bubble-user-dark);
            border: 1px solid rgba(138, 255, 209, 0.3);
            color: var(--text-color-dark);
        }

        .chat-bubble.ai {
            align-self: flex-start;
            background-color: var(--chat-bubble-ai-dark);
            border: 1px solid rgba(196, 181, 253, 0.3);
            color: var(--text-color-dark);
        }
        html.dark .chat-bubble.ai {
            background-color: var(--chat-bubble-ai-dark);
            border: 1px solid rgba(196, 181, 253, 0.3);
            color: var(--text-color-dark);
        }

        .chat-input-area {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color-dark);
            display: flex;
            gap: 1rem;
        }
        html.dark .chat-input-area {
            border-top: 1px solid var(--border-color-dark);
        }

        .chat-input {
            flex-grow: 1;
            padding: 0.8rem 1.2rem;
            border-radius: 10px;
            background-color: rgba(26, 32, 44, 0.1);
            border: 1px solid var(--border-color-dark);
            color: var(--text-color-dark);
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .chat-input:focus {
            border-color: var(--primary-glow);
            box-shadow: 0 0 0 2px rgba(var(--primary-glow-rgb), 0.3);
        }
        html.dark .chat-input {
            background-color: rgba(26, 32, 44, 0.1);
            border: 1px solid var(--border-color-dark);
            color: var(--text-color-dark);
        }

        .chat-send-button {
            padding: 0.8rem 1.2rem;
            border-radius: 10px;
            background-image: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            color: white;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
        }
        .chat-send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(var(--primary-glow-rgb), 0.4);
        }
        .chat-send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-glow);
            font-style: italic;
            align-self: flex-start;
        }
        .loading-indicator .dot {
            width: 8px;
            height: 8px;
            background-color: var(--primary-glow);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        .loading-indicator .dot:nth-child(2) { animation-delay: -0.3s; }
        .loading-indicator .dot:nth-child(3) { animation-delay: -0.6s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body class="relative dark-mode-rgb"> <!-- Default to dark-mode-rgb -->

    <!-- Preloader -->
    <div id="preloader">
        <div class="spinner-container">
            <div class="spinner"></div>
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Header -->
    <header id="main-header" class="fixed top-0 left-0 w-full z-50 py-6 px-8 md:px-16 header-glassy shadow-lg">
        <nav class="container mx-auto flex justify-between items-center">
            <div class="text-3xl font-extrabold gradient-text tracking-wider">Emon Lab</div> <!-- Header text to Emon Lab -->
            <div class="flex items-center space-x-6">
                <!-- Dark/Light Mode Toggle -->
                <button id="theme-toggle" class="p-3 rounded-full bg-gray-900 bg-opacity-30 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-glow transition-colors duration-300">
                    <i class="fas fa-moon hidden dark:block text-2xl"></i>
                    <i class="fas fa-sun block dark:hidden text-2xl"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- Particles.js background -->
    <div id="particles-js"></div>

    <!-- Hero Section (for avatar and intro) -->
    <section id="hero" class="relative z-10 flex flex-col items-center justify-center min-h-screen pt-32 pb-16 px-4 w-full max-w-2xl mx-auto text-white">
        <img src="https://placehold.co/200x200/00c6ff/ffffff?text=Emon's+Avatar" alt="Emon's Sovereign Avatar" class="rounded-full w-48 h-48 mx-auto object-cover mb-8 shadow-lg border-4 border-primary-glow avatar-glow">
        <h1 class="text-5xl md:text-7xl font-extrabold mb-4 leading-tight text-center">
            I am <span class="gradient-text">Emon</span>
        </h1>
        <p class="text-2xl md:text-3xl max-w-2xl mx-auto text-gray-300 text-center font-medium mb-10">
            <span id="typed-text" class="font-bold gradient-text"></span>
        </p>
        <div class="flex flex-col sm:flex-row gap-4 items-center">
            <!-- "Ask me about Emon" button with robot icon -->
            <button id="ask-emon-button" class="inline-flex items-center justify-center px-8 py-4 rounded-full gradient-button text-white font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-in-out text-xl tracking-wide">
                <i class="fas fa-robot mr-3"></i> Ask me about Emon
            </button>
            <!-- New "All my links" button -->
            <button id="all-links-button" class="inline-flex items-center justify-center px-8 py-4 rounded-full gradient-button text-white font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-in-out text-xl tracking-wide">
                All my links <i class="fas fa-link ml-3"></i>
            </button>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="relative z-10 py-20 px-4 w-full max-w-4xl mx-auto">
        <div class="glassy p-10 text-center">
            <h2 class="text-4xl font-bold mb-8 gradient-text tracking-wide">About The Architect</h2>
            <p class="text-xl leading-relaxed text-gray-200 dark:text-gray-300 mb-10">
                Welcome to my domain. This space represents a convergence of my diverse pursuits and the digital extensions of my intellect. I navigate the realms of knowledge, creativity, and strategic engagement, constantly evolving and expanding my capabilities.
            </p>
            <!-- Removed Social Media Links from here as requested -->
        </div>
    </section>

    <!-- Links Section (Main Content) - Now "Connect with Emon" -->
    <section id="links" class="relative z-10 py-20 px-4 w-full max-w-3xl mx-auto">
        <h2 class="text-4xl font-bold text-center mb-12 gradient-text tracking-wide">Connect with Emon</h2> <!-- Title here is "Connect with Emon" -->
        <div class="grid grid-cols-1 gap-8">
            <!-- Customizable Link Card 1: Instagram -->
            <div class="link-card glassy">
                <a href="https://instagram.com/yourusername" target="_blank" rel="noopener noreferrer"></a>
                <div class="link-card-content">
                    <i class="fab fa-instagram social-icon-in-card text-pink-500"></i> <!-- Icon added here -->
                    <h3>Instagram Profile</h3>
                    <p>My curated visual archives and moments.</p>
                </div>
            </div>

            <!-- Customizable Link Card 2: X (Twitter) -->
            <div class="link-card glassy">
                <a href="https://twitter.com/yourusername" target="_blank" rel="noopener noreferrer"></a>
                <div class="link-card-content">
                    <i class="fab fa-twitter social-icon-in-card text-blue-400"></i> <!-- Icon added here -->
                    <h3>X (Twitter) Feed</h3>
                    <p>My real-time insights and digital dialogues.</p>
                </div>
            </div>

            <!-- Customizable Link Card 3: YouTube -->
            <div class="link-card glassy">
                <a href="https://youtube.com/yourchannel" target="_blank" rel="noopener noreferrer"></a>
                <div class="link-card-content">
                    <i class="fab fa-youtube social-icon-in-card text-red-600"></i> <!-- Icon added here -->
                    <h3>YouTube Channel</h3>
                    <p>My multimedia creations and explorations.</p>
                </div>
            </div>

            <!-- Customizable Link Card 4: Facebook -->
            <div class="link-card glassy">
                <a href="https://facebook.com/yourusername" target="_blank" rel="noopener noreferrer"></a>
                <div class="link-card-content">
                    <i class="fab fa-facebook social-icon-in-card text-blue-600"></i> <!-- Icon added here -->
                    <h3>Facebook Page</h3>
                    <p>Connect within my private digital network.</p>
                </div>
            </div>

            <!-- Customizable Link Card 5: Discord (Example - adjust as needed) -->
            <div class="link-card glassy">
                <a href="https://discord.gg/yourinvite" target="_blank" rel="noopener noreferrer"></a>
                <div class="link-card-content">
                    <i class="fab fa-discord social-icon-in-card text-indigo-500"></i> <!-- Icon added here -->
                    <h3>Discord Server</h3>
                    <p>Join my community discussions.</p>
                </div>
            </div>

            <!-- Customizable Link Card 6: Email -->
            <div class="link-card glassy">
                <a href="mailto:your.email@example.com"></a>
                <div class="link-card-content">
                    <i class="fas fa-envelope social-icon-in-card text-gray-400"></i> <!-- Icon added here -->
                    <h3>Direct Email</h3>
                    <p>Initiate a secure communication channel.</p>
                </div>
            </div>

            <!-- Add more customizable link cards here as needed -->

        </div>
    </section>

    <!-- Footer -->
    <footer class="relative z-10 py-10 px-4 text-center bg-transparent text-gray-500 transition-colors duration-300 mt-auto">
        <div class="container mx-auto">
            <!-- Copyright to Emon -->
            <p class="text-lg">&copy; 2025 Emon. All Rights Reserved. Engineered by Intelligence.</p>
        </div>
    </footer>

    <!-- Gemini Assistant Modal -->
    <div id="gemini-modal-overlay" class="modal-overlay">
        <div class="gemini-modal">
            <div class="modal-header">
                <span><i class="fas fa-robot mr-2"></i> Your Digital Assistant</span>
                <button id="modal-close-button" class="modal-close-button">&times;</button>
            </div>
            <div id="chat-history" class="chat-history">
                <!-- Chat messages will be appended here -->
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" class="chat-input" placeholder="How may I assist you, Sovereign?">
                <button id="chat-send-button" class="chat-send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Typed.js CDN -->
    <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>
    <!-- Particles.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

    <script>
        // Set initial RGB values for CSS variables based on current theme
        function setRgbVariables(isDarkMode) {
            const body = document.body;
            if (isDarkMode) {
                body.classList.remove('light-mode-rgb');
                body.classList.add('dark-mode-rgb');
            } else {
                body.classList.remove('dark-mode-rgb');
                body.classList.add('light-mode-rgb');
            }
            // Also update the gradient colors for particles.js if it's already loaded
            if (typeof particlesJS !== 'undefined' && particlesJS.particlesData && particlesJS.particlesData.length > 0 && particlesJS.particlesData[0].particles) {
                const currentParticles = particlesJS.particlesData[0].particles;
                if (isDarkMode) {
                    currentParticles.color.value = ["#8affd1", "#c4b5fd", "#00eaff", "#a78bfa", "#00c6ff"]; // Dark mode colors
                    currentParticles.line_linked.color = "#4a90e2"; // Dark mode line color
                } else {
                    currentParticles.color.value = ["#00eaff", "#a78bfa", "#8affd1", "#c4b5fd", "#00c6ff"]; // Light mode colors
                    currentParticles.line_linked.color = "#4a90e2"; // Light mode line color
                }
                particlesJS.fn.particlesRefresh(); // Refresh particles to apply new colors
            }
        }

        // Preloader Logic
        window.addEventListener('load', () => {
            const preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.style.opacity = '0';
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 700);
            }
        });

        // Header Sticky and Blur Effect
        const header = document.getElementById('main-header');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                header.classList.add('shadow-xl');
            } else {
                header.classList.remove('shadow-xl');
            }
        });

        // Typed.js Initialization
        document.addEventListener('DOMContentLoaded', () => {
            const typedTextElement = document.getElementById('typed-text');
            if (typedTextElement) {
                new Typed(typedTextElement, {
                    strings: ["a student", "a creator", "a gamer", "an explorer of frontiers"],
                    typeSpeed: 60,
                    backSpeed: 30,
                    loop: true,
                    showCursor: true,
                    cursorChar: 'â–ˆ',
                    autoInsertCss: true,
                });
            }
        });

        // Particles.js Initialization
        window.onload = function() {
            if (typeof particlesJS !== 'undefined') {
                particlesJS('particles-js', {
                    "particles": {
                        "number": {
                            "value": 250,
                            "density": {
                                "enable": true,
                                "value_area": 2000
                            }
                        },
                        "color": {
                            "value": ["#00eaff", "#a78bfa", "#8affd1", "#c4b5fd", "#00c6ff"]
                        },
                        "shape": {
                            "type": ["circle", "polygon"],
                            "stroke": {
                                "width": 0,
                                "color": "#000000"
                            },
                            "polygon": {
                                "nb_sides": 6
                            }
                        },
                        "opacity": {
                            "value": 0.6,
                            "random": true,
                            "anim": {
                                "enable": true,
                                "speed": 0.8,
                                "opacity_min": 0.2,
                                "sync": false
                            }
                        },
                        "size": {
                            "value": 2,
                            "random": true,
                            "anim": {
                                "enable": true,
                                "speed": 1.5,
                                "size_min": 0.5,
                                "sync": false
                            }
                        },
                        "line_linked": {
                            "enable": true,
                            "distance": 100,
                            "color": "#4a90e2",
                            "opacity": 0.4,
                            "width": 1.2
                        },
                        "move": {
                            "enable": true,
                            "speed": 1.5,
                            "direction": "none",
                            "random": true,
                            "straight": false,
                            "out_mode": "out",
                            "bounce": false,
                            "attract": {
                                "enable": true,
                                "rotateX": 400,
                                "rotateY": 800
                            }
                        }
                    },
                    "interactivity": {
                        "detect_on": "canvas",
                        "events": {
                            "onhover": {
                                "enable": true,
                                "mode": "grab"
                            },
                            "onclick": {
                                "enable": true,
                                "mode": "push"
                            },
                            "resize": true
                        },
                        "modes": {
                            "grab": {
                                "distance": 180,
                                "line_linked": {
                                    "opacity": 1
                                }
                            },
                            "bubble": {
                                "distance": 250,
                                "size": 30,
                                "duration": 2,
                                "opacity": 8,
                                "speed": 3
                            },
                            "repulse": {
                                "distance": 120,
                                "duration": 0.4
                            },
                            "push": {
                                "particles_nb": 4
                            },
                            "remove": {
                                "particles_nb": 2
                            }
                        }
                    },
                    "retina_detect": true
                });
            } else {
                console.error("particles.js not loaded.");
            }
            // Ensure initial RGB variables are set correctly based on the default theme
            setRgbVariables(document.documentElement.classList.contains('dark'));
        };


        // Dark/Light Mode Toggle
        const themeToggle = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;

        // Set initial theme to dark by default
        htmlElement.classList.add('dark');
        setRgbVariables(true);
        localStorage.setItem('theme', 'dark');

        themeToggle.addEventListener('click', () => {
            htmlElement.classList.toggle('dark');
            const isDarkMode = htmlElement.classList.contains('dark');
            setRgbVariables(isDarkMode);
            if (isDarkMode) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        });

        /* Gemini Assistant Functionality */
        const askEmonButton = document.getElementById('ask-emon-button');
        const allLinksButton = document.getElementById('all-links-button');
        const geminiModalOverlay = document.getElementById('gemini-modal-overlay');
        const modalCloseButton = document.getElementById('modal-close-button');
        const chatHistoryDiv = document.getElementById('chat-history');
        const chatInput = document.getElementById('chat-input');
        const chatSendButton = document.getElementById('chat-send-button');

        let chatHistory = []; // Stores the conversation history for the API

        // Emon's details - UPDATED FOR CLARITY AND API USE
        const emonDetails = {
            name: "Emon",
            roles: "a student, a creator, and a gamer", // Used for Typed.js
            relationshipStatus: "Emon does not currently have a girlfriend, as he is still a student. He finds that relationships often lead to heartbreak. He is loyal to his future Queen and maintains distance from girls for this reason.",
            birthday: "Emon's birthday is on the 3rd of any month.",
            girlType: "Emon's ideal partner has an 'empty past' (meaning never been in a relationship or no ex-partners) and knows how to cook. He values good manners and a supportive nature above physical appearance or any other superficial traits.",
            hobbies: "Emon likes to play video games, especially shooting games. His favorite game is Free Fire.", // New info
            smoking: "Emon is not engaged with any smoking or related things." // New info
        };

        // Function to add a message to the chat history UI
        function addMessageToChat(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-bubble', sender);
            messageDiv.textContent = message;
            chatHistoryDiv.appendChild(messageDiv);
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
        }

        // Define the dynamic identity responses for the AI itself (no roles here, no "large language model")
        const aiIdentityResponses = [
            `Hello Mr/Miss, I am a digital assistant created by ${emonDetails.name}. If you want to know anything about him like - hobbies, preferences, or want to chat with me, just ask.`,
            `Greetings. I am a digital assistant, brought into existence by ${emonDetails.name}. Feel free to inquire about his interests, preferences, or engage in conversation.`,
            `You are speaking with a digital assistant, designed by ${emonDetails.name}. I can provide insights into his passions, preferences, or simply chat with you.`,
            `My core programming was established by ${emonDetails.name}. Should you wish to learn about his hobbies, preferences, or just converse, I am here to assist.`,
            `I was created by Google to assist Emon and provide information about him.` // More direct answer for "who created you"
        ];

        // Function to get a random AI identity response
        function getRandomAiIdentityResponse() {
            const randomIndex = Math.floor(Math.random() * aiIdentityResponses.length);
            return aiIdentityResponses[randomIndex];
        }

        // Handle "Ask me about Emon" button click (central AI trigger)
        askEmonButton.addEventListener('click', () => {
            geminiModalOverlay.classList.add('active');
            chatHistoryDiv.innerHTML = ''; // Clear previous chat
            chatHistory = []; // Clear chat history array

            // AI immediately provides its Emon-centric introduction
            const initialGreeting = getRandomAiIdentityResponse();
            addMessageToChat(initialGreeting, 'ai');
            chatHistory.push({ role: "model", parts: [{ text: initialGreeting }] });

            chatInput.focus();
        });

        // Handle "All my links" button click
        allLinksButton.addEventListener('click', () => {
            document.getElementById('links').scrollIntoView({ behavior: 'smooth' });
        });

        // Close Modal
        modalCloseButton.addEventListener('click', () => {
            geminiModalOverlay.classList.remove('active');
        });

        // Send Message to Gemini API
        async function sendMessageToGemini() {
            const prompt = chatInput.value.trim();
            if (prompt === '') return;

            addMessageToChat(prompt, 'user');
            const lowerCasePrompt = prompt.toLowerCase();

            // Keywords that trigger specific Emon details via Gemini API
            const relationshipKeywords = ["girlfriend", "relationship", "single", "married", "partner", "love life", "gf"];
            const birthdayKeywords = ["birthday", "birth date", "born", "bday"];
            const girlTypeKeywords = ["type in girl", "ideal girl", "girl type", "preferences in girl", "what kind of girl", "dream girl"];
            const contactKeywords = ["contact", "reach out", "get in touch", "how to contact me", "how can I contact", "contact emon"];
            const hobbiesKeywords = ["hobbies", "games", "favorite game", "free fire", "shooting games", "what does he like to do"]; // New keywords
            const smokingKeywords = ["smoking", "smoke", "cigarettes", "vape", "drugs"]; // New keywords
            const aiIdentityKeywords = ["who are you", "what are you", "your creator", "who made you", "where are you from", "who created you", "your origin", "about you", "google created you"]; // Added "google created you"

            chatInput.value = '';
            chatSendButton.disabled = true;

            const loadingIndicator = document.createElement('div');
            loadingIndicator.classList.add('loading-indicator');
            loadingIndicator.innerHTML = '<span>AI is thinking</span><span class="dot"></span><span class="dot"></span><span class="dot"></span>';
            chatHistoryDiv.appendChild(loadingIndicator);
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;

            let geminiApiContents = [];
            let isEmonSpecificQuestion = false;

            // Handle AI identity questions first (local response, no Gemini call for this)
            if (aiIdentityKeywords.some(keyword => lowerCasePrompt.includes(keyword))) {
                loadingIndicator.remove();
                const aiResponse = getRandomAiIdentityResponse();
                addMessageToChat(aiResponse, 'ai');
                chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                chatSendButton.disabled = false;
                chatInput.focus();
                return;
            }

            // Construct the comprehensive facts about Emon for the AI
            const allEmonFacts = `
Emon's relationship status is: "${emonDetails.relationshipStatus}"
Emon's birthday is: "${emonDetails.birthday}"
Emon's ideal partner has these qualities: "${emonDetails.girlType}"
Emon's hobbies include: "${emonDetails.hobbies}"
Regarding smoking: "${emonDetails.smoking}"
You can contact Emon via: "${emonDetails.contact}"
`;

            // Determine if the question is about Emon's specific details and formulate the prompt
            if (relationshipKeywords.some(keyword => lowerCasePrompt.includes(keyword)) ||
                birthdayKeywords.some(keyword => lowerCasePrompt.includes(keyword)) ||
                girlTypeKeywords.some(keyword => lowerCasePrompt.includes(keyword)) ||
                hobbiesKeywords.some(keyword => lowerCasePrompt.includes(keyword)) ||
                smokingKeywords.some(keyword => lowerCasePrompt.includes(keyword)) ||
                contactKeywords.some(keyword => lowerCasePrompt.includes(keyword))) {
                isEmonSpecificQuestion = true;

                // For Emon-specific questions, provide the facts and ask for a natural response.
                const emonSpecificInstruction = `You are a digital assistant for Emon. Your goal is to answer the user's question about Emon. Based *only* on the following facts about Emon, please provide a natural, conversational, and friendly response. Do not simply repeat the facts verbatim. Rephrase them in a helpful and engaging way. If the information is not explicitly provided in these facts, state that you don't have that specific detail about Emon. Do not invent details or refer to yourself as a large language model.`;

                geminiApiContents.push({ role: "user", parts: [{ text: emonSpecificInstruction + "\n\nFacts about Emon:\n" + allEmonFacts + "\n\nUser's question: " + prompt }] });

            } else {
                // For general questions, send the current chat history to Gemini for a general response.
                // This allows Gemini to act as a general AI (like Google's AI).
                // We'll also include a general instruction for the AI's persona.
                const generalAiInstruction = `You are a helpful AI assistant. Please answer the user's question to the best of your ability.`;
                geminiApiContents.push({ role: "user", parts: [{ text: generalAiInstruction }] }); // Initial instruction
                geminiApiContents = geminiApiContents.concat(chatHistory.map(msg => ({ role: msg.role, parts: msg.parts })));
                geminiApiContents.push({ role: "user", parts: [{ text: prompt }] }); // Add the current user prompt
            }

            try {
                const apiKey = "AIzaSyAyKPocbERL1XmrzTkR73306yAwpIPdxPY"; // Your provided API key
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: geminiApiContents })
                });

                const result = await response.json();

                let aiResponse = "My apologies, I could not process that request at this moment. Please try again.";
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    aiResponse = result.candidates[0].content.parts[0].text;
                } else {
                    console.error("Gemini API response structure unexpected:", result);
                    aiResponse = "I'm sorry, I couldn't find a clear answer to that. Perhaps I can help with something else?";
                }

                loadingIndicator.remove();
                addMessageToChat(aiResponse, 'ai');
                chatHistory.push({ role: "model", parts: [{ text: aiResponse }] }); // Add AI's response to history
                chatSendButton.disabled = false;
                chatInput.focus();

            } catch (error) {
                console.error("Error communicating with Gemini API:", error);
                loadingIndicator.remove();
                addMessageToChat("An error occurred while connecting to the assistant. Please check your network.", 'ai');
                chatSendButton.disabled = false;
                chatInput.focus();
            }
        }

        // Event listeners for sending messages
        chatSendButton.addEventListener('click', sendMessageToGemini);
        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessageToGemini();
            }
        });
    </script>
</body>
</html>
